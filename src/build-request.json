{
  "kind": "build_request",
  "title": "Republish latest build and prevent admin-token links from being shared",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add a runtime guard that detects if the app is opened with an admin-mode hash token (e.g., `#caffeineAdminToken=...`) and automatically converts the URL to the clean public URL (`PUBLIC_SITE_URL`) so visitors do not land on the Caffeine admin/dashboard screen.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Publish my latest version to live"
        ]
      },
      "acceptanceCriteria": [
        "If `window.location.hash` contains `caffeineAdminToken`, the app removes the hash (using `history.replaceState` or equivalent) and navigates to the clean public URL (`https://npt-for-sunidhi.caffeine.xyz`).",
        "If there is no `caffeineAdminToken` in the hash, the app behavior is unchanged.",
        "The guard does not rely on any backend changes and does not break local development."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update the share-link UX to explicitly warn users not to share admin links and to always share the canonical public URL from `frontend/src/config/publicSiteUrl.ts`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "When I share this link this shows see in screenshot"
        ]
      },
      "acceptanceCriteria": [
        "The share control continues to copy exactly `PUBLIC_SITE_URL` (not `window.location.href`).",
        "The UI includes a short English note near the share control clarifying that links containing `#caffeineAdminToken=...` are admin-only and should not be shared.",
        "Copy fallback UI (manual copy input) continues to work as before."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update the deployment checklist documentation to include a verification step that the published/live visitor link contains no `#caffeineAdminToken` fragment and that the clean URL renders the app content.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Publish my latest version to live"
        ]
      },
      "acceptanceCriteria": [
        "`frontend/DEPLOYMENT_CHECKLIST.md` includes a step to verify sharing the clean URL `https://npt-for-sunidhi.caffeine.xyz` (with no hash) shows the app content.",
        "Checklist includes a note that admin-token links should never be sent to visitors because they show the Caffeine admin/dashboard screen."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under `frontend/src/components/ui` (compose these components only).",
    "Do not modify any files listed as immutable: `frontend/src/hooks/useInternetIdentity.ts`, `frontend/src/hooks/useInternetIdentity.tsx`, `frontend/src/hooks/useActor.ts`, `frontend/src/main.tsx`, and all of `frontend/src/components/ui`.",
    "Backend must remain a single Motoko actor in `backend/main.mo` (no additional backend services or databases)."
  ],
  "nonGoals": [
    "Implementing new backend features (the backend actor is currently empty and does not need changes for this request).",
    "Adding third-party authentication providers beyond Internet Identity.",
    "Adding new pages or major redesign unrelated to publishing and share-link correctness."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}